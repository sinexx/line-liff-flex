<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>‡∏™‡πà‡∏á Flex ‡∏à‡∏≤‡∏Å LIFF</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="text-align:center; font-family:sans-serif; margin-top:50px;">
  <h2>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á Flex ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô LIFF...</h2>
  <p id="status">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwXmnC8n4VktgCZweK_SdHL6VHBUi0JnczklcLr1YAKZ_XmyZVQEBgYdoijGeGuWmWa/exec"; // üëà ‡∏ß‡∏≤‡∏á URL ‡∏à‡∏≤‡∏Å Apps Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

    async function main() {
      try {
        await liff.init({ liffId: "2005776859-WvyweL4D" }); // üëà ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        if (!liff.isLoggedIn()) liff.login();

        const profile = await liff.getProfile();
        const userId = profile.userId;
        document.getElementById("status").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á userId: " + userId;

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Apps Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á Flex
        const res = await fetch(GAS_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId: userId })
        });

        const result = await res.text();
        document.getElementById("status").innerText = "‚úÖ ‡∏™‡πà‡∏á Flex ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (" + result + ")";
        
        setTimeout(() => {
          liff.closeWindow(); // ‡∏õ‡∏¥‡∏î LIFF ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ä‡∏ó
        }, 2000);
      } catch (err) {
        document.getElementById("status").innerText = "‚ùå Error: " + err;
      }
    }

    main();
  </script>
</body>
</html>
